- 权限控制设计方案

在实际项目中，都会有权限管理控制（菜单权限和数据权限），具体来说就是：不仅要控制一个用户能够访问哪些资源，还要控制用户只能访问资源的哪些数据。

- <font color="red">控制访问资源的权限管理，比较经典的方案是 RBAC</font>
- <font color="red">控制数据的权限，可以使用 Spring AOP 切面技术</font>

**RBAC**

Role_Based Access Control，基于角色的权限访问控制，是一种数据库设计思想，根据设计数据库设计方案，完成项目的权限控制；

**RBAC 三原则**

1. 最小权限：给角色配置的权限是其完成任务所需要的最小权限集合。
2. 责任分离：通过相互独立互斥的角色共同完成任务
3. 数据抽象：通过权限的抽象来体现，RBAC 支持的数据抽象程度与 RBAC 的实现细节有关

**模型分类**

1. RBAC0：最简单的用户角色权限模型，是 RBAC 权限模型中最核心的一部分，后边其他模型都是在此基础上建立。在 RBAC0 中，一个用户可以具备多个角色，一个角色可以具备多个权限，最终用户所具备的权限是用户所具备的角色的权限并集
2. RBAC1：是在 RBAC0 的基础上引入了角色继承，让角色有了上下级关系。
3. RBAC2：是在 RBAC0 的基础上进行扩展，引入了静态职责分离和动态职责分离

   - 静态职责分离：在设置阶段就做好了限制。比如同一用户不能授予互斥的角色，用户只能有有限个角色，用户获得高级权限之前要有低级权限等等
   - 动态职责分离：在运行阶段进行限制。比如运行时同一用户下 5 个角色中只能同时有 2 个角色激活等等

4. RBAC3：将 RBAC1 和 RBAC2 结合起来，就形成了 RBAC3。

`我们日常见到的很多权限模型都是在 RBAC 的基础上扩展出来的。例如在有的系统中我们可以见到用户组的概念，就是将用户分组，用户同时具备自身的角色以及分组的角色。`

**数据规则权限**

> 可以通过自定义注解 + Spring AOP，实现 Sql 拼接；如果使用 MybatisPlus 框架，不写 sql，可以定义公共方法，将 sql 条件部分放在 QueryWrapper<>对象中。

**步骤**

1. 自定义一个数据权限的注解，比如叫 PermissionData
2. 在对应的资源请求方法上添加注解，比如在列表上添加注解 @PermissionData
3. 利用 AOP 抓取到用户对应角色的所有数据规则并进行 SQL 拼接，最终在 SQL 层面实现数据过滤

**Shiro 和 Security 比较**

> 都是安全框架，实现对访问权限的控制，包括用户认证和授权两部分。

Shiro 是 Apache 下的项目，比较可靠，且不跟任何的框架或者容器绑定，可以独立运行；还在简单性和灵活性方面拥有巨大优势。

Spring Security 基于 Spring 开发，有更好的社区资源服务。

如果项目中使用 Spring 框架，配合 Spring Security 做权限更加方便，而 Shiro 需要和 Spring 进行整合开发，但是 Shiro 的配置和使用比较简单，Spring Security 上手复杂

Authentication Authorization


## 权限

是用户可以访问的资源，包括页面权限、操作权限、数据权限

页面权限：即用户登录系统可以看到的页面，由菜单来控制，菜单包括一级菜单和二级菜单，只要用户有一级和二级菜单的权限，那么用户就可以访问页面
操作权限：即页面的功能按钮，包括查看、新增、修改、删除、审核等，用户点击删除按钮时，后台会校验用户角色下的所有权限是否包含该删除权限。如果是，就可以进行下一步操作，反之提示无权限
         
 "可见即可操作"，意思是如果页面上能够看到操作按钮，那么用户就可以操作，要实现此需求，这里就需要前端来配合，前端开发把用户的权限信息缓存，在页面判断用户是否包含此权限，如果有，就显示该按钮，如果没有，就隐藏该按钮。 

数据权限：数据权限就是用户在同一页面看到的数据是不同的，比如财务部只能看到其部门下的用户数据，采购部只看采购部的数据。

## 统一认证平台

是一种集中式的身份认证和访问控制系统，旨在为多个应用系统提供统一的身份验证和授权功能。

从设计考虑，主要包括：

1. 用户管理：统一认证平台需要包含用户管理功能，包括用户注册、登录、密码重置等。用户信息可以存储在一个集中的用户数据库中，以便其他应用系统可以共享和访问。
2. 单点登录（Single Sign-On，SSO）：通过实现单点登录功能，用户只需要一次登录就可以访问多个应用系统，而无需在每个系统中都进行独立的登录。这大大提高了用户体验和工作效率。
3. 统一的身份验证服务：统一认证平台需要提供统一的身份验证服务，包括支持常见的身份验证协议（如OAuth、OpenID Connect）和接口，以满足不同应用系统的认证需求。
4. 访问控制和权限管理：统一认证平台应该具备访问控制和权限管理的能力，以确保只有经过授权的用户可以访问特定的资源或功能。这可以通过定义角色、权限和访问策略来实现。
5. 安全性和数据保护：设计统一认证平台时需要考虑安全性和数据保护措施，例如使用安全的身份验证协议和加密算法来保护用户凭证和传输的数据。另外，可以采用多因素认证（如短信验证码、指纹识别）提高身份验证的安全性。
6. 日志和监控：为了保证系统的安全性和可追溯性，统一认证平台应该记录用户的登录和操作日志，并提供监控和报警机制，以及相应的审计功能。
7. 可扩展性和兼容性：设计统一认证平台时应考虑其可扩展性和兼容性，使其能够适应不断增长的用户数量和接入的应用系统。同时，要支持各种常用的身份验证方式和标准，以便与现有的应用系统集成。

实现步骤：

1. 需求分析：根据实际业务需求，确定统一认证平台的功能模块和技术架构等。这包括用户管理、单点登录、身份验证服务、访问控制和权限管理、安全性和数据保护、日志和监控等方面。
2. 技术选型：选择适合的技术框架和工具，如Spring Boot、Spring Security、OAuth 2.0、OpenID Connect等。同时，需要考虑基础设施的支持如数据库、缓存、消息队列、负载均衡器和容器等。
3. 数据库设计：设计用户信息存储结构和访问控制策略，包括用户认证凭证（用户名、密码、令牌等）以及用户角色、权限等信息。同时，需要考虑数据加密、备份和恢复等方面。
4. 组件集成：对接应用系统，实现单点登录、身份验证服务和访问控制等功能。常见的接入方式包括OAuth 2.0授权码模式、OpenID Connect标识提供者模式和JWT Token模式等。
5. 安全性和数据保护：采用多种安全措施，如使用HTTPS传输协议、加密算法保护用户凭证和数据、多因素认证、防火墙、Web应用程序防火墙等。同时，需要定期进行漏洞扫描和安全审计。
6. 日志和监控：记录用户的登录和操作日志，并提供监控和报警机制，以及相应的审计功能。常见的组件包括ELK（Elasticsearch + Logstash + Kibana）和Prometheus + Grafana等。
7. 测试和部署：对统一认证平台进行全面的测试，包括系统集成测试、性能测试、安全测试和可用性测试等。同时，考虑将平台部署到云端或容器化环境中，以提高可扩展性和弹性。
