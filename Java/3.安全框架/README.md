- 权限控制设计方案

在实际项目中，都会有权限管理控制（菜单权限和数据权限），具体来说就是：不仅要控制一个用户能够访问哪些资源，还要控制用户只能访问资源的哪些数据。

- <font color="red">控制访问资源的权限管理，比较经典的方案是 RBAC</font>
- <font color="red">控制数据的权限，可以使用 Spring AOP 切面技术</font>

**RBAC**

Role_Based Access Control，基于角色的权限访问控制，是一种数据库设计思想，根据设计数据库设计方案，完成项目的权限控制；

**RBAC 三原则**

1. 最小权限：给角色配置的权限是其完成任务所需要的最小权限集合。
2. 责任分离：通过相互独立互斥的角色共同完成任务
3. 数据抽象：通过权限的抽象来体现，RBAC 支持的数据抽象程度与 RBAC 的实现细节有关

**模型分类**

1. RBAC0：最简单的用户角色权限模型，是 RBAC 权限模型中最核心的一部分，后边其他模型都是在此基础上建立。在 RBAC0 中，一个用户可以具备多个角色，一个角色可以具备多个权限，最终用户所具备的权限是用户所具备的角色的权限并集
2. RBAC1：是在 RBAC0 的基础上引入了角色继承，让角色有了上下级关系。
3. RBAC2：是在 RBAC0 的基础上进行扩展，引入了静态职责分离和动态职责分离

   - 静态职责分离：在设置阶段就做好了限制。比如同一用户不能授予互斥的角色，用户只能有有限个角色，用户获得高级权限之前要有低级权限等等
   - 动态职责分离：在运行阶段进行限制。比如运行时同一用户下 5 个角色中只能同时有 2 个角色激活等等

4. RBAC3：将 RBAC1 和 RBAC2 结合起来，就形成了 RBAC3。

`我们日常见到的很多权限模型都是在 RBAC 的基础上扩展出来的。例如在有的系统中我们可以见到用户组的概念，就是将用户分组，用户同时具备自身的角色以及分组的角色。`

**数据规则权限**

> 可以通过自定义注解 + Spring AOP，实现 Sql 拼接；如果使用 MybatisPlus 框架，不写 sql，可以定义公共方法，将 sql 条件部分放在 QueryWrapper<>对象中。

**步骤**

1. 自定义一个数据权限的注解，比如叫 PermissionData
2. 在对应的资源请求方法上添加注解，比如在列表上添加注解 @PermissionData
3. 利用 AOP 抓取到用户对应角色的所有数据规则并进行 SQL 拼接，最终在 SQL 层面实现数据过滤

**Shiro 和 Security 比较**

> 都是安全框架，实现对访问权限的控制，包括用户认证和授权两部分。

Shiro 是 Apache 下的项目，比较可靠，且不跟任何的框架或者容器绑定，可以独立运行；还在简单性和灵活性方面拥有巨大优势。

Spring Security 基于 Spring 开发，有更好的社区资源服务。

如果项目中使用 Spring 框架，配合 Spring Security 做权限更加方便，而 Shiro 需要和 Spring 进行整合开发，但是 Shiro 的配置和使用比较简单，Spring Security 上手复杂

Authentication Authorization


## 权限

是用户可以访问的资源，包括页面权限、操作权限、数据权限

页面权限：即用户登录系统可以看到的页面，由菜单来控制，菜单包括一级菜单和二级菜单，只要用户有一级和二级菜单的权限，那么用户就可以访问页面
操作权限：即页面的功能按钮，包括查看、新增、修改、删除、审核等，用户点击删除按钮时，后台会校验用户角色下的所有权限是否包含该删除权限。如果是，就可以进行下一步操作，反之提示无权限
         
 "可见即可操作"，意思是如果页面上能够看到操作按钮，那么用户就可以操作，要实现此需求，这里就需要前端来配合，前端开发把用户的权限信息缓存，在页面判断用户是否包含此权限，如果有，就显示该按钮，如果没有，就隐藏该按钮。 

数据权限：数据权限就是用户在同一页面看到的数据是不同的，比如财务部只能看到其部门下的用户数据，采购部只看采购部的数据。
